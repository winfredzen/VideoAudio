# 视频编解码

## SPS

参考：

+ [H264码流中SPS PPS详解](https://zhuanlan.zhihu.com/p/27896239)

> 在 H.264 标准协议中规定了多种不同的 NAL Unit 类型，其中类型 7 表示该 NAL Unit 内保存的数据为 Sequence Paramater Set（序列参数集）。
>
> 在 H.264 的各种语法元素中，SPS 中的信息至关重要。如果其中的数据丢失或出现错误，那么解码过程很可能会失败。
>
> SPS 即 Sequence Paramater Set，又称作序列参数集。SPS 中保存了一组编码视频序列 (Coded video sequence) 的全局参数。所谓的编码视频序列即原始视频的一帧一帧的像素数据经过编码之后的结构组成的序列。而每一帧的编码后数据所依赖的参数保存于图像参数集中。一般情况 SPS 和 PPS 的 NAL Unit 通常位于整个码流的起始位置。但在某些特殊情况下，在码流中间也可能出现这两种结构，主要原因可能为：
>
> - 解码器需要在码流中间开始解码
> - 编码器在编码的过程中改变了码流的参数（如图像分辨率等）



### Profile & Level

**H264 Profile**

对视频压缩特性的描述，Profile越高，就说明采用了越高级的压缩特性

> **profile_idc**
>
> 标识当前H.264码流的profile。我们知道，H.264中定义了三种常用的档次profile：
>
> 基准档次：baseline profile;
>
> 主要档次：main profile;
>
> 扩展档次：extended profile;
>
> 在H.264的SPS中，第一个字节表示profile_idc，根据profile_idc的值可以确定码流符合哪一种档次。判断规律为：
>
> profile_idc = 66 → baseline profile;
>
> profile_idc = 77 → main profile;
>
> profile_idc = 88 → extended profile;
>
> 在新版的标准中，还包括了High、High 10、High 4:2:2、High 4:4:4、High 10 Intra、High
> 4:2:2 Intra、High 4:4:4 Intra、CAVLC 4:4:4 Intra等，每一种都由不同的profile_idc表示。

![089](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/089.png)

![090](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/090.png)

**H264 Level**

对视频规格的描述，Level越高，视频的码率、分辨率、fps越高

>  **level_idc**
>
> 标识当前码流的Level。编码的Level定义了某种条件下的最大视频分辨率、最大视频帧率等参数，码流所遵从的level由level_idc指定。
>
> 当前码流中，level_idc = 0x1e = 30，因此码流的级别为3。

![091](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/091.png)



## 其它参数

![092](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/021.png)

> `pic_width_in_mbs_minus1`
>
> 用于计算图像的宽度。单位为宏块个数，因此图像的实际宽度为:
>
> `frame_width = 16 × (pic\_width\_in\_mbs_minus1 + 1)`

> `pic_height_in_map_units_minus1`
>
> 使用`PicHeightInMapUnits`来度量视频中一帧图像的高度。`PicHeightInMapUnits`并非图像明确的以像素或宏块为单位的高度，而需要考虑该宏块是帧编码或场编码。`PicHeightInMapUnits`的计算方式为：
>
> `PicHeightInMapUnits = pic\_height\_in\_map\_units\_minus1 + 1;`

![093](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/093.png)

![094](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/094.png)



## PPS

> H.264中另一重要的参数集合为图像参数集Picture Paramater Set(PPS)。通常情况下，PPS类似于SPS，在H.264的裸码流中单独保存在一个NAL Unit中，只是PPS NAL Unit的nal_unit_type值为8；而在封装格式中，PPS通常与SPS一起，保存在视频文件的文件头中。

![095](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/095.png)





## Slice Header

![096](https://github.com/winfredzen/VideoAudio/blob/main/Basic/image/096.png)



## 分析工具

1.StreamEye

2.CodecVisa

3.雷神开发的工具

















